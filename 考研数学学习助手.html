<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è€ƒç ”æ•°å­¦å­¦ä¹ åŠ©æ‰‹</title>

    <!-- MathJaxé…ç½® -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true,
                processEnvironments: true
            },
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
            }
        };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>

    <!-- Chart.jså›¾è¡¨åº“ -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.js"></script>

    <!-- å¤–éƒ¨æ ·å¼è¡¨ -->
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <!-- ä¸»å®¹å™¨ -->
    <div class="app-container">
        <!-- å·¦ä¾§å¯¼èˆªæ  -->
        <nav class="sidebar">
            <div class="logo">
                <div class="logo-icon">ğŸ“š</div>
                è€ƒç ”æ•°å­¦åŠ©æ‰‹
            </div>
            <ul class="nav-menu">
                <li class="active" data-view="dashboard">
                    <span class="nav-icon">ğŸ“Š</span>
                    <span>é¦–é¡µ</span>
                </li>
                <li data-view="plan">
                    <span class="nav-icon">ğŸ“…</span>
                    <span>å­¦ä¹ è§„åˆ’</span>
                </li>
                <li data-view="knowledge">
                    <span class="nav-icon">ğŸ“š</span>
                    <span>çŸ¥è¯†ç‚¹å­¦ä¹ </span>
                </li>
                <li data-view="practice">
                    <span class="nav-icon">âœï¸</span>
                    <span>ç»ƒä¹ æµ‹è¯•</span>
                </li>
                <li data-view="ai-tutor">
                    <span class="nav-icon">ğŸ¤–</span>
                    <span>AIåŠ©æ•™</span>
                </li>
                <li data-view="statistics">
                    <span class="nav-icon">ğŸ“ˆ</span>
                    <span>å­¦ä¹ ç»Ÿè®¡</span>
                </li>
                <li data-view="settings">
                    <span class="nav-icon">âš™ï¸</span>
                    <span>è®¾ç½®</span>
                </li>
            </ul>
        </nav>

        <!-- å³ä¾§å†…å®¹åŒº -->
        <main class="content-area">
            <div id="view-container">
                <!-- å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
            </div>
        </main>
    </div>

    <script>
        // ========== å„è§†å›¾æ¸²æŸ“å‡½æ•° ==========

        // é¦–é¡µ/ä»ªè¡¨æ¿
        function renderDashboard() {
            const container = document.getElementById('view-container');

            // è·å–æ•°æ®
            const examDate = new Date('2026-12-23');
            const today = new Date();
            const daysLeft = Math.ceil((examDate - today) / (1000 * 60 * 60 * 24));
            const dateStr = today.toLocaleDateString('zh-CN', { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' });

            // æ¿€åŠ±è¯­å¥
            const motivations = [
                'æ¯ä¸€é“é¢˜éƒ½æ˜¯é€šå¾€æˆåŠŸçš„é˜¶æ¢¯',
                'åšæŒå°±æ˜¯èƒœåˆ©ï¼Œä»Šå¤©ä¹Ÿè¦åŠ æ²¹ï¼',
                'åƒé‡Œä¹‹è¡Œï¼Œå§‹äºè¶³ä¸‹',
                'å­¦ä¹ æ˜¯æœ€å¥½çš„æŠ•èµ„',
                'ä»Šå¤©çš„åŠªåŠ›æ˜¯æ˜å¤©çš„æ”¶è·',
                'ç›¸ä¿¡è‡ªå·±ï¼Œä½ å¯ä»¥çš„ï¼'
            ];
            const motivation = motivations[Math.floor(Math.random() * motivations.length)];

            // è·å–å­¦ä¹ æ•°æ®
            const plan = dataManager.load('studyPlan', null);
            const progress = dataManager.load('learningProgress', {});
            const knowledgeTree = dataManager.load('knowledgeTree', getDefaultKnowledgeTree());

            // è®¡ç®—ç»Ÿè®¡æ•°æ®
            const stats = calculateDashboardStats(plan, progress, knowledgeTree);

            container.innerHTML = `
                <div class="dashboard-container">
                    <!-- æ¬¢è¿åŒºåŸŸ -->
                    <div class="welcome-section">
                        <div class="welcome-content">
                            <h2>ğŸ“ æ¬¢è¿å›æ¥ï¼</h2>
                            <div class="date-info">ğŸ“… ${dateStr}</div>
                            <div class="motivation">ğŸ’¬ "${motivation}"</div>
                        </div>
                        <div class="countdown-box">
                            <div class="countdown-number">${daysLeft}</div>
                            <div class="countdown-label">å¤©åè€ƒç ”</div>
                        </div>
                    </div>

                    <!-- ç»Ÿè®¡å¡ç‰‡ -->
                    <div class="stats-cards">
                        <div class="stat-card">
                            <div class="stat-icon blue">ğŸ“‹</div>
                            <div class="stat-info">
                                <div class="stat-value">${stats.todayTaskCount}</div>
                                <div class="stat-label">ä»Šæ—¥ä»»åŠ¡</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon green">âœ…</div>
                            <div class="stat-info">
                                <div class="stat-value">${stats.todayCompletionRate}%</div>
                                <div class="stat-label">ä»Šæ—¥å®Œæˆç‡</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon orange">ğŸ”¥</div>
                            <div class="stat-info">
                                <div class="stat-value">${stats.streakDays}</div>
                                <div class="stat-label">è¿ç»­å­¦ä¹ å¤©æ•°</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon purple">ğŸ“š</div>
                            <div class="stat-info">
                                <div class="stat-value">${stats.completedUnits}/${stats.totalUnits}</div>
                                <div class="stat-label">çŸ¥è¯†ç‚¹è¿›åº¦</div>
                            </div>
                        </div>
                    </div>

                    <!-- ä¸»å†…å®¹åŒº -->
                    <div class="dashboard-main">
                        <!-- ä»Šæ—¥ä»»åŠ¡ -->
                        <div class="today-tasks-card">
                            <div class="card-header-row">
                                <h3>ğŸ“‹ ä»Šæ—¥å­¦ä¹ ä»»åŠ¡</h3>
                                <span class="task-progress-mini">${stats.todayCompletedTasks}/${stats.todayTaskCount} å·²å®Œæˆ</span>
                            </div>
                            <div class="dashboard-task-list" id="dashboard-task-list">
                                ${renderDashboardTasks(plan)}
                            </div>
                        </div>

                        <!-- å­¦ä¹ è¿›åº¦ä¸å¿«æ·å…¥å£ -->
                        <div class="progress-actions-card">
                            <!-- è¿›åº¦å›¾è¡¨ -->
                            <div class="progress-charts-section">
                                <h3>ğŸ“Š å­¦ä¹ è¿›åº¦</h3>
                                <div class="charts-row">
                                    <div class="chart-item">
                                        <div class="chart-wrapper">
                                            <canvas id="chart-calculus"></canvas>
                                            <div class="chart-center-text">${stats.subjectProgress.calculus}%</div>
                                        </div>
                                        <div class="chart-label">å¾®ç§¯åˆ†</div>
                                    </div>
                                    <div class="chart-item">
                                        <div class="chart-wrapper">
                                            <canvas id="chart-linear"></canvas>
                                            <div class="chart-center-text">${stats.subjectProgress.linearAlgebra}%</div>
                                        </div>
                                        <div class="chart-label">çº¿æ€§ä»£æ•°</div>
                                    </div>
                                    <div class="chart-item">
                                        <div class="chart-wrapper">
                                            <canvas id="chart-prob"></canvas>
                                            <div class="chart-center-text">${stats.subjectProgress.probability}%</div>
                                        </div>
                                        <div class="chart-label">æ¦‚ç‡è®º</div>
                                    </div>
                                </div>
                            </div>

                            <!-- å¿«æ·å…¥å£ -->
                            <div class="quick-actions-section">
                                <h3>ğŸš€ å¿«æ·å…¥å£</h3>
                                <div class="quick-actions-grid">
                                    <button class="quick-action-btn" onclick="viewManager.switchView('knowledge')">
                                        <span class="action-icon">ğŸ“–</span>
                                        <span class="action-text">ç»§ç»­å­¦ä¹ </span>
                                    </button>
                                    <button class="quick-action-btn" onclick="viewManager.switchView('practice')">
                                        <span class="action-icon">âœï¸</span>
                                        <span class="action-text">å¼€å§‹ç»ƒä¹ </span>
                                    </button>
                                    <button class="quick-action-btn" onclick="viewManager.switchView('plan')">
                                        <span class="action-icon">ğŸ“…</span>
                                        <span class="action-text">å­¦ä¹ è§„åˆ’</span>
                                    </button>
                                    <button class="quick-action-btn" onclick="viewManager.switchView('ai-tutor')">
                                        <span class="action-icon">ğŸ¤–</span>
                                        <span class="action-text">AIåŠ©æ•™</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- æœ€è¿‘æ´»åŠ¨ -->
                    <div class="recent-activity-card">
                        <h3>ğŸ“ æœ€è¿‘å­¦ä¹ æ´»åŠ¨</h3>
                        <div class="activity-list" id="activity-list">
                            ${renderRecentActivity(progress)}
                        </div>
                    </div>
                </div>
            `;

            // åˆå§‹åŒ–å›¾è¡¨
            initDashboardCharts(stats.subjectProgress);
        }

        // è®¡ç®—ä»ªè¡¨æ¿ç»Ÿè®¡æ•°æ®
        function calculateDashboardStats(plan, progress, knowledgeTree) {
            // è®¡ç®—çŸ¥è¯†ç‚¹ç»Ÿè®¡
            let totalUnits = 0;
            let completedUnits = 0;
            const subjectProgress = { calculus: 0, linearAlgebra: 0, probability: 0 };
            const subjectTotal = { calculus: 0, linearAlgebra: 0, probability: 0 };

            for (const [subjectKey, subject] of Object.entries(knowledgeTree)) {
                for (const chapter of subject.chapters) {
                    for (const unit of chapter.units) {
                        totalUnits++;
                        subjectTotal[subjectKey]++;
                        const status = progress[unit.id]?.status;
                        if (status === 'completed' || status === 'mastered') {
                            completedUnits++;
                            subjectProgress[subjectKey]++;
                        }
                    }
                }
            }

            // è®¡ç®—å„ç§‘ç›®ç™¾åˆ†æ¯”
            for (const key of Object.keys(subjectProgress)) {
                subjectProgress[key] = subjectTotal[key] > 0
                    ? Math.round((subjectProgress[key] / subjectTotal[key]) * 100)
                    : 0;
            }

            // ä»Šæ—¥ä»»åŠ¡ç»Ÿè®¡
            let todayTaskCount = 0;
            let todayCompletedTasks = 0;
            if (plan && plan.dailyTasks) {
                const today = new Date().toISOString().split('T')[0];
                const todayTasks = plan.dailyTasks.find(dt => dt.date === today);
                if (todayTasks && todayTasks.tasks) {
                    todayTaskCount = todayTasks.tasks.length;
                    todayCompletedTasks = todayTasks.tasks.filter(t => t.status === 'completed').length;
                }
            }

            // è¿ç»­å­¦ä¹ å¤©æ•° (ç®€åŒ–è®¡ç®—)
            const streakDays = calculateStreakDays(progress);

            return {
                totalUnits,
                completedUnits,
                subjectProgress,
                todayTaskCount,
                todayCompletedTasks,
                todayCompletionRate: todayTaskCount > 0 ? Math.round((todayCompletedTasks / todayTaskCount) * 100) : 0,
                streakDays
            };
        }

        // è®¡ç®—è¿ç»­å­¦ä¹ å¤©æ•°
        function calculateStreakDays(progress) {
            const dates = new Set();
            for (const data of Object.values(progress)) {
                if (data.lastStudied) {
                    dates.add(data.lastStudied.split('T')[0]);
                }
            }

            if (dates.size === 0) return 0;

            const sortedDates = Array.from(dates).sort().reverse();
            const today = new Date().toISOString().split('T')[0];

            // æ£€æŸ¥ä»Šå¤©æˆ–æ˜¨å¤©æ˜¯å¦å­¦ä¹ 
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            const yesterdayStr = yesterday.toISOString().split('T')[0];

            if (!dates.has(today) && !dates.has(yesterdayStr)) {
                return 0;
            }

            let streak = 0;
            let checkDate = dates.has(today) ? new Date() : yesterday;

            while (dates.has(checkDate.toISOString().split('T')[0])) {
                streak++;
                checkDate.setDate(checkDate.getDate() - 1);
            }

            return streak;
        }

        // æ¸²æŸ“ä»Šæ—¥ä»»åŠ¡åˆ—è¡¨
        function renderDashboardTasks(plan) {
            if (!plan || !plan.dailyTasks) {
                return `
                    <div class="no-tasks-message">
                        <div class="icon">ğŸ“‹</div>
                        <div>æš‚æ— å­¦ä¹ è§„åˆ’</div>
                        <button class="btn btn-primary" style="margin-top: 15px;" onclick="viewManager.switchView('plan')">
                            åˆ›å»ºå­¦ä¹ è§„åˆ’
                        </button>
                    </div>
                `;
            }

            const today = new Date().toISOString().split('T')[0];
            const todayTasks = plan.dailyTasks.find(dt => dt.date === today);

            if (!todayTasks || todayTasks.tasks.length === 0) {
                return `
                    <div class="no-tasks-message">
                        <div class="icon">âœ…</div>
                        <div>ä»Šæ—¥æ²¡æœ‰å®‰æ’å­¦ä¹ ä»»åŠ¡</div>
                    </div>
                `;
            }

            return todayTasks.tasks.map(task => {
                const isCompleted = task.status === 'completed';
                const taskName = task.knowledgeName || task.description || 'å­¦ä¹ ä»»åŠ¡';
                const taskType = task.type === 'knowledge' ? 'ğŸ“– çŸ¥è¯†ç‚¹'
                    : task.type === 'practice' ? 'âœï¸ ç»ƒä¹ '
                    : 'ğŸ”„ å¤ä¹ ';

                return `
                    <div class="dashboard-task-item ${isCompleted ? 'completed' : ''}"
                         onclick="toggleDashboardTask('${task.id}')">
                        <div class="task-checkbox ${isCompleted ? 'checked' : ''}">
                            ${isCompleted ? 'âœ“' : ''}
                        </div>
                        <div class="task-content">
                            <div class="task-title">${taskName}</div>
                            <div class="task-subtitle">${taskType}</div>
                        </div>
                        <div class="task-duration">${task.duration}åˆ†é’Ÿ</div>
                    </div>
                `;
            }).join('');
        }

        // åˆ‡æ¢ä»»åŠ¡å®ŒæˆçŠ¶æ€
        function toggleDashboardTask(taskId) {
            const plan = dataManager.load('studyPlan', null);
            if (!plan || !plan.dailyTasks) return;

            const today = new Date().toISOString().split('T')[0];
            const todayTasks = plan.dailyTasks.find(dt => dt.date === today);
            if (!todayTasks) return;

            const task = todayTasks.tasks.find(t => t.id === taskId);
            if (!task) return;

            // åˆ‡æ¢çŠ¶æ€
            task.status = task.status === 'completed' ? 'pending' : 'completed';

            // ä¿å­˜å¹¶åˆ·æ–°
            dataManager.save('studyPlan', plan);
            renderDashboard();
        }

        // æ¸²æŸ“æœ€è¿‘æ´»åŠ¨
        function renderRecentActivity(progress) {
            const activities = [];

            for (const [unitId, data] of Object.entries(progress)) {
                if (data.lastStudied) {
                    activities.push({
                        unitId,
                        unitName: data.unitName || unitId,
                        subject: data.subject || 'calculus',
                        lastStudied: data.lastStudied,
                        status: data.status
                    });
                }
            }

            if (activities.length === 0) {
                return `
                    <div class="no-activity-message">
                        <div>æš‚æ— å­¦ä¹ è®°å½•</div>
                        <div style="margin-top: 10px;">å¼€å§‹å­¦ä¹ ï¼Œè®°å½•å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ</div>
                    </div>
                `;
            }

            // æŒ‰æ—¶é—´æ’åºï¼Œå–æœ€è¿‘5ä¸ª
            activities.sort((a, b) => new Date(b.lastStudied) - new Date(a.lastStudied));
            const recentActivities = activities.slice(0, 5);

            const subjectNames = {
                calculus: 'å¾®ç§¯åˆ†',
                linearAlgebra: 'çº¿ä»£',
                probability: 'æ¦‚ç‡è®º'
            };

            return recentActivities.map(activity => {
                const timeAgo = getTimeAgo(activity.lastStudied);
                const subjectName = subjectNames[activity.subject] || activity.subject;

                return `
                    <div class="activity-item" onclick="goToKnowledge('${activity.unitId}')">
                        <div class="activity-icon">ğŸ“–</div>
                        <div class="activity-info">
                            <div class="activity-title">${activity.unitName}</div>
                            <div class="activity-time">${timeAgo}</div>
                        </div>
                        <span class="activity-badge ${activity.subject}">${subjectName}</span>
                    </div>
                `;
            }).join('');
        }

        // è®¡ç®—æ—¶é—´å·®
        function getTimeAgo(dateStr) {
            const date = new Date(dateStr);
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);

            if (diffMins < 60) return `${diffMins}åˆ†é’Ÿå‰`;
            if (diffHours < 24) return `${diffHours}å°æ—¶å‰`;
            if (diffDays < 7) return `${diffDays}å¤©å‰`;
            return date.toLocaleDateString('zh-CN');
        }

        // è·³è½¬åˆ°çŸ¥è¯†ç‚¹
        function goToKnowledge(unitId) {
            // ä¿å­˜è¦è·³è½¬çš„çŸ¥è¯†ç‚¹ID
            dataManager.save('targetKnowledgeId', unitId);
            viewManager.switchView('knowledge');
        }

        // åˆå§‹åŒ–ä»ªè¡¨æ¿å›¾è¡¨
        function initDashboardCharts(subjectProgress) {
            const chartConfig = (progress, color) => ({
                type: 'doughnut',
                data: {
                    datasets: [{
                        data: [progress, 100 - progress],
                        backgroundColor: [color, '#e0e0e0'],
                        borderWidth: 0
                    }]
                },
                options: {
                    cutout: '70%',
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: { display: false },
                        tooltip: { enabled: false }
                    }
                }
            });

            // å¾®ç§¯åˆ†å›¾è¡¨
            const ctx1 = document.getElementById('chart-calculus');
            if (ctx1) new Chart(ctx1, chartConfig(subjectProgress.calculus, '#2196F3'));

            // çº¿æ€§ä»£æ•°å›¾è¡¨
            const ctx2 = document.getElementById('chart-linear');
            if (ctx2) new Chart(ctx2, chartConfig(subjectProgress.linearAlgebra, '#4CAF50'));

            // æ¦‚ç‡è®ºå›¾è¡¨
            const ctx3 = document.getElementById('chart-prob');
            if (ctx3) new Chart(ctx3, chartConfig(subjectProgress.probability, '#FF9800'));
        }

        // å­¦ä¹ è§„åˆ’
        function renderPlanView() {
            // æ£€æŸ¥æ˜¯å¦å·²æœ‰è§„åˆ’
            const savedPlan = dataManager.load('studyPlan', null);
            if (savedPlan && savedPlan.applied) {
                renderPlanDisplay(savedPlan);
            } else {
                renderPlanConfig();
            }
        }


        // ç»ƒä¹ æµ‹è¯•
        function renderPracticeView() {
            const container = document.getElementById('view-container');
            container.innerHTML = `
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">âœï¸ ç»ƒä¹ æµ‹è¯•</div>
                    </div>

                    <!-- æ ‡ç­¾é¡µåˆ‡æ¢ -->
                    <div style="display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 2px solid #f0f0f0; padding-bottom: 10px;">
                        <button class="practice-tab active" data-tab="exam" style="padding: 10px 20px; background: var(--primary-color); color: white; border: none; border-radius: 5px; cursor: pointer;">
                            æ¨¡æ‹Ÿè¯•å·
                        </button>
                        <button class="practice-tab" data-tab="exercise" style="padding: 10px 20px; background: #f0f0f0; color: #666; border: none; border-radius: 5px; cursor: pointer;">
                            ä¸“é¡¹ç»ƒä¹ 
                        </button>
                        <button class="practice-tab" data-tab="wrong" style="padding: 10px 20px; background: #f0f0f0; color: #666; border: none; border-radius: 5px; cursor: pointer;">
                            é”™é¢˜æœ¬
                        </button>
                    </div>

                    <!-- æ ‡ç­¾é¡µå†…å®¹ -->
                    <div id="practice-content">
                        <!-- åŠ¨æ€åŠ è½½å†…å®¹ -->
                    </div>
                </div>
            `;

            // ç»‘å®šæ ‡ç­¾é¡µåˆ‡æ¢äº‹ä»¶
            document.querySelectorAll('.practice-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    // æ›´æ–°æ ‡ç­¾æ ·å¼
                    document.querySelectorAll('.practice-tab').forEach(t => {
                        t.style.background = '#f0f0f0';
                        t.style.color = '#666';
                        t.classList.remove('active');
                    });
                    this.style.background = 'var(--primary-color)';
                    this.style.color = 'white';
                    this.classList.add('active');

                    // åˆ‡æ¢å†…å®¹
                    const tabType = this.dataset.tab;
                    loadPracticeTab(tabType);
                });
            });

            // é»˜è®¤åŠ è½½æ¨¡æ‹Ÿè¯•å·
            loadPracticeTab('exam');
        }

        // åŠ è½½ç»ƒä¹ æµ‹è¯•æ ‡ç­¾é¡µå†…å®¹
        function loadPracticeTab(tabType) {
            const contentDiv = document.getElementById('practice-content');

            if (tabType === 'exam') {
                contentDiv.innerHTML = `
                    <div style="text-align: center; padding: 20px;">
                        <button class="btn btn-primary" onclick="startExam()" style="font-size: 18px; padding: 15px 40px;">
                            ğŸ¯ å¼€å§‹æ¨¡æ‹Ÿè€ƒè¯•
                        </button>
                        <p style="margin-top: 15px; color: #666;">
                            æ¨¡æ‹Ÿè¯•å·åŒ…å«é€‰æ‹©é¢˜ã€å¡«ç©ºé¢˜ã€è§£ç­”é¢˜ï¼Œæ”¯æŒAIæ¢é¢˜å’Œè§£æåŠŸèƒ½
                        </p>
                    </div>
                `;
            } else if (tabType === 'exercise') {
                contentDiv.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ“</div>
                        <div class="empty-state-text">ä¸“é¡¹ç»ƒä¹ åŠŸèƒ½å¼€å‘ä¸­...</div>
                        <div class="empty-state-text" style="font-size: 14px; color: #aaa;">
                            å°†æ”¯æŒæŒ‰çŸ¥è¯†ç‚¹ã€éš¾åº¦ç­›é€‰é¢˜ç›®å¹¶è¿›è¡Œç»ƒä¹ 
                        </div>
                    </div>
                `;
            } else if (tabType === 'wrong') {
                contentDiv.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ“‹</div>
                        <div class="empty-state-text">é”™é¢˜æœ¬åŠŸèƒ½å¼€å‘ä¸­...</div>
                        <div class="empty-state-text" style="font-size: 14px; color: #aaa;">
                            å°†è®°å½•æ‰€æœ‰é”™é¢˜å¹¶æ”¯æŒåˆ†ç±»æŸ¥çœ‹å’Œé‡åš
                        </div>
                    </div>
                `;
            }
        }

        // å¼€å§‹æ¨¡æ‹Ÿè€ƒè¯•
        function startExam() {
            // æ‰“å¼€åŸæœ‰çš„æ¨¡æ‹Ÿè¯•å·æ–‡ä»¶
            window.open('è€ƒç ”æ•°å­¦ä¸€æ¨¡æ‹Ÿé¢˜.html', '_blank');
        }

        // AIåŠ©æ•™
        function renderAITutorView() {
            const container = document.getElementById('view-container');
            container.innerHTML = `
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">ğŸ¤– AIåŠ©æ•™</div>
                    </div>
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ¤–</div>
                        <div class="empty-state-text">AIåŠ©æ•™åŠŸèƒ½å¼€å‘ä¸­...</div>
                        <div class="empty-state-text" style="font-size: 14px; color: #aaa;">
                            éšæ—¶å‘AIæé—®,è·å¾—è¯¦ç»†çš„æ•°å­¦é—®é¢˜è§£ç­”
                        </div>
                    </div>
                </div>
            `;
        }

        // å­¦ä¹ ç»Ÿè®¡
        function renderStatisticsView() {
            const container = document.getElementById('view-container');
            container.innerHTML = `
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">ğŸ“ˆ å­¦ä¹ ç»Ÿè®¡</div>
                    </div>
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ“ˆ</div>
                        <div class="empty-state-text">å­¦ä¹ ç»Ÿè®¡åŠŸèƒ½å¼€å‘ä¸­...</div>
                        <div class="empty-state-text" style="font-size: 14px; color: #aaa;">
                            å°†å±•ç¤ºå­¦ä¹ æ—¶é•¿ã€æ­£ç¡®ç‡ã€çŸ¥è¯†ç‚¹æŒæ¡åº¦ç­‰æ•°æ®å›¾è¡¨
                        </div>
                    </div>
                </div>
            `;
        }

        // è®¾ç½®
        function renderSettingsView() {
            const container = document.getElementById('view-container');
            container.innerHTML = `
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">âš™ï¸ è®¾ç½®</div>
                    </div>

                    <h3 style="margin-bottom: 15px; color: #333;">æ•°æ®ç®¡ç†</h3>

                    <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 30px;">
                        <button class="btn btn-primary" onclick="dataManager.exportAllData()">
                            ğŸ“¥ å¯¼å‡ºæ•°æ®
                        </button>
                        <button class="btn btn-warning" onclick="handleImportData()">
                            ğŸ“¤ å¯¼å…¥æ•°æ®
                        </button>
                        <button class="btn btn-danger" onclick="handleClearData()">
                            ğŸ—‘ï¸ æ¸…ç©ºæ•°æ®
                        </button>
                    </div>

                    <input type="file" id="importFileInput" accept=".json" style="display: none;"
                           onchange="handleFileSelected(event)">

                    <div class="empty-state">
                        <div class="empty-state-text" style="font-size: 14px; color: #aaa;">
                            æ›´å¤šè®¾ç½®åŠŸèƒ½å¼€å‘ä¸­...
                        </div>
                    </div>
                </div>
            `;
        }

        // ========== è¾…åŠ©åŠŸèƒ½å‡½æ•° ==========

        // å¤„ç†å¯¼å…¥æ•°æ®
        function handleImportData() {
            document.getElementById('importFileInput').click();
        }

        // å¤„ç†æ–‡ä»¶é€‰æ‹©
        async function handleFileSelected(event) {
            const file = event.target.files[0];
            if (!file) return;

            try {
                const data = await dataManager.importData(file);
                alert(`æ•°æ®å¯¼å…¥æˆåŠŸ!\nå¯¼å‡ºæ—¶é—´: ${new Date(data.exportTime).toLocaleString()}`);
                location.reload(); // é‡æ–°åŠ è½½é¡µé¢ä»¥åº”ç”¨æ–°æ•°æ®
            } catch (error) {
                alert(`æ•°æ®å¯¼å…¥å¤±è´¥: ${error.message}`);
            }

            // æ¸…ç©ºæ–‡ä»¶è¾“å…¥
            event.target.value = '';
        }

        // å¤„ç†æ¸…ç©ºæ•°æ®
        function handleClearData() {
            if (!confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ•°æ®å—?\n\næ­¤æ“ä½œä¸å¯æ¢å¤,å»ºè®®å…ˆå¯¼å‡ºå¤‡ä»½!')) {
                return;
            }

            if (!confirm('å†æ¬¡ç¡®è®¤: çœŸçš„è¦æ¸…ç©ºæ‰€æœ‰å­¦ä¹ æ•°æ®å—?')) {
                return;
            }

            dataManager.clearAllData();
            alert('æ•°æ®å·²æ¸…ç©º!');
            location.reload();
        }

        // ========== åˆå§‹åŒ– ==========
        window.onload = function() {
            console.log('è€ƒç ”æ•°å­¦å­¦ä¹ åŠ©æ‰‹ v1.0.0');
            console.log('ç³»ç»Ÿåˆå§‹åŒ–ä¸­...');

            // æ³¨å†Œè§†å›¾
            viewManager.register('dashboard', renderDashboard);
            viewManager.register('practice', renderPracticeView);
            viewManager.register('ai-tutor', renderAITutorView);
            viewManager.register('statistics', renderStatisticsView);
            viewManager.register('settings', renderSettingsView);

            // åŠ è½½ä¸Šæ¬¡çš„è§†å›¾
            viewManager.loadLastView();

            // ç»‘å®šå¯¼èˆªç‚¹å‡»äº‹ä»¶
            document.querySelectorAll('.nav-menu li').forEach(li => {
                li.addEventListener('click', function() {
                    const view = this.dataset.view;
                    if (view) {
                        viewManager.switchView(view);
                    }
                });
            });

            console.log('ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ!');
        };
    </script>

    <!-- å¤–éƒ¨è„šæœ¬ -->
    <script src="js/ai-adapter.js"></script>
    <script src="js/data-manager.js"></script>
    <script src="js/knowledge-data.js"></script>
    <script src="js/knowledge-module.js"></script>
    <script src="js/plan-module.js"></script>
</body>
</html>
